name: ğŸš€ Continuous Release

on:
  push:
    branches:
      - main
    # ç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢: ãƒªãƒªãƒ¼ã‚¹å‡¦ç†è‡ªä½“ã®ã‚³ãƒŸãƒƒãƒˆã§ã¯ç™ºç«ã•ã›ãªã„è¨­å®šãªã©ã¯
    # ä»Šå›ã®ã€Œã‚¿ã‚°æ‰“ã¡ã€æ–¹å¼ãªã‚‰ä¸è¦ï¼ˆã‚¿ã‚°ä½œæˆã¯pushãƒˆãƒªã‚¬ãƒ¼ã«å¼•ã£ã‹ã‹ã‚‰ãªã„ãŸã‚ï¼‰

permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest
    # è‡ªåˆ†ï¼ˆã‚ªãƒ¼ãƒŠãƒ¼ï¼‰ã®ãƒãƒ¼ã‚¸ã®ã¿ç™ºç«ã•ã›ã‚‹å®‰å…¨è£…ç½®
    if: github.actor == github.repository_owner

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 1. ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¨ˆç®— & ã‚¿ã‚°æ‰“ã¡
      - name: Bump version and push tag
        id: tag_version
        uses: mathieudutour/github-tag-action@v6.2
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          default_bump: patch
          # ã“ã“ã§ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®å¯¾å¿œã‚’æ˜ç¤ºã§ãã¾ã™
          release_branches: main

      # 2. GitHubãƒªãƒªãƒ¼ã‚¹ä½œæˆï¼ˆã“ã“ãŒChangelogã«ãªã‚Šã¾ã™ï¼‰
      - name: Create a GitHub release
        uses: ncipollo/release-action@v1
        with:
          tag: ${{ steps.tag_version.outputs.new_tag }}
          name: Release ${{ steps.tag_version.outputs.new_tag }}
          body: ${{ steps.tag_version.outputs.changelog }}
          token: ${{ secrets.GITHUB_TOKEN }}
          # ãƒ¡ã‚¸ãƒ£ãƒ¼ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ(vX.0.0)ã®æ™‚ã ã‘ã€Œãƒ‰ãƒ©ãƒ•ãƒˆ(ä¸‹æ›¸ã)ã€ã«ã—ã¦
          # å…¬é–‹å‰ã«äººé–“ãŒç·¨é›†ã™ã‚‹ãƒãƒ£ãƒ³ã‚¹ã‚’ä½œã‚‹è¨­å®šï¼ˆãŠå¥½ã¿ã§ï¼ï¼‰
          # draft: ${{ contains(steps.tag_version.outputs.new_tag, '.0.0') }}
